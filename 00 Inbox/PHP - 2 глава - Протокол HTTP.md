> Работа любого сайта строится по клиент-серверной технологии: браузер выступает в качестве клиента и посылает по сети запрос на сервер. Сервер здесь — это программ- ное обеспечение, запущенное на компьютере в сети Интернет, прослушивающее опре- деленный порт. Получив запрос, сервер отправляет обратно ответ, используя в качестве транспортного протокола связку TCP/IP. ПОЯСНЕНИЕ Сервером часто называют и программное обеспечение для обработки запросов, и аппа- ратный сервер — мощный компьютер, где запущено это программное обеспечение. Как правило, аппаратные серверы имеют юнит-корпус, чтобы их удобнее было располагать в стойках дата-центров. В книге под термином «сервер», почти всегда имеется в виду про- граммное обеспечение. Информация, которой обмениваются браузер и сервер, структурирована и понятна обе- им сторонам. Правила и порядок обмена запросами и ответами определяются специ- альным протоколом HTTP (HyperText Transfer Protocol, протокол передачи гипертек- ста). Этот протокол разработал основоположник Интернета Тим Бернерс-Ли в 1989 го- ду для передачи ссылающихся друг на друга текстов. Такую возможность обеспечивает язык разметки HTML, в состав которого входят инструменты для создания гиперссы- лок. Именно гиперссылки позволяют переходить от одной страницы к другой, иногда даже не различая границ сайтов и воспринимая Интернет как единую информационную сеть.

[[PHP 8. Наиболее полное руководство [2023].pdf#page=43&selection=6,0,34,5|PHP 8. Наиболее полное руководство [2023], page 43]]

> Протокол HTTP используется для доставки веб-страниц и сопутствующих документов от веб-сервера к браузеру. Когда вы посещаете сайт и переходите по ссылкам, вы каждый раз шлете HTTP-запрос серверу. В ответ сервер присылает HTTP-ответ, чаще всего — HTML-страницу (рис. 2.1). Эта страница содержит структурированный текст и ссылки на изображения, аудио- и видеоматериалы.

[[PHP 8. Наиболее полное руководство [2023].pdf#page=44&selection=6,0,10,49|PHP 8. Наиболее полное руководство [2023], page 44]]

> Поскольку с одной стороны находится клиент (браузер), а с другой стороны — сервер, протокол называют клиент-серверным. Клиенты отправляют HTTP-запросы, чтобы по- лучить какой-либо ресурс. Веб-сервер обрабатывает запрос и отправляет запрашивае- мый ресурс в виде HTTP-ответа. HTML-страница обычно ссылается на множество других материалов (файлов): каскад- ные таблицы стилей, JS-файлы, изображения, видео и т. п. Для извлечения каждого из этих файлов с сервера формируется отдельный HTTP-запрос, в ответ на который веб- сервер высылает нужный файл.

[[PHP 8. Наиболее полное руководство [2023].pdf#page=44&selection=19,0,29,28|PHP 8. Наиболее полное руководство [2023], page 44]]

> Таким образом, чтобы сформировать страницу, веб-браузер направляет на сервер мно- жество запросов для извлечения самых разнообразных файлов. Чтобы отличать их друг от друга, в протоколе HTTP вводится понятие ресурса — уникального идентификатора для источника информации (например, изображения). Каждый ресурс имеет адрес, который называется унифицированным указателем ресур- са (Uniform Resource Locator, URL). Именно URL вводится в адресной строке браузера или кодируется в гиперссылках, по которым можно переходить с одной страницы на другую (рис. 2.2).

[[PHP 8. Наиболее полное руководство [2023].pdf#page=44&selection=33,0,48,18|PHP 8. Наиболее полное руководство [2023], page 44]]

> Простейшим примером URL может служить ссылка: https://example.com:80/path/to/image.jpg Ресурс состоит из следующих компонентов (рис. 2.3):  https:// — префикс, который задает протокол обращения к ресурсу. В нашем случае https — это протокол HTTP поверх SSL (безопасного шифрованного канала связи);  example.ru — доменное имя или IP-адрес, которые задают местоположение сервера с ресурсом в сети Интернет;  /path/to/image.jpg — путь к ресурсу на сервере, который позволяет отличать один ресурс от другого.

[[PHP 8. Наиболее полное руководство [2023].pdf#page=45&selection=4,0,29,18|PHP 8. Наиболее полное руководство [2023], page 45]]

>  http://example.com:80/path/to/image.jpg?parameters Отличие от предыдущего варианта заключается в строке parameters, следующей после вопросительного знака. В ней может быть все, что угодно, и она может быть почти лю- бой длины. Как раз с помощью этой строки можно передать в программу на стороне сервера информацию от клиента, который запрашивает ресурс. УТОЧНЕНИЕ На самом деле существуют некоторые ограничения на длину строки параметров. Однако на практике сталкиваться с ними приходится весьма редко. Если URL слишком длинен для браузера, то это легко обнаруживается — соответствующая гиперссылка просто «переста- нет нажиматься».

[[PHP 8. Наиболее полное руководство [2023].pdf#page=46&selection=7,57,26,16|PHP 8. Наиболее полное руководство [2023], page 46]]

> Параметры принято задавать в виде пары ключ-значение: переменная=значение А если нужно передать несколько параметров? Например, не только часовой пояс, но и имя пользователя? Сделаем это следующим образом: http://example.com/script.php?time=+5&name=Vasya Обратите внимание: параметры отделяются друг от друга с помощью символа ампер- санда &. В дальнейшем мы будем придерживаться этого соглашения, поскольку имен- но таким образом поступают браузеры при обработке форм.

[[PHP 8. Наиболее полное руководство [2023].pdf#page=46&selection=48,23,65,55|PHP 8. Наиболее полное руководство [2023], page 46]]

> HTTP-запросы направляют серверу определенные команды, которые в протоколе назы- ваются методами. Методы сообщают веб-серверу, какие действия следует предпринять в рамках запроса. Вот наиболее часто используемые методы HTTP:  GET — запрос на получение ресурса, ответ может кешироваться;  POST — запрос на создание ресурса, ответ никогда не кешируется;  PUT — сохранение/обновление ресурса, ответ никогда не кешируется;  DELETE — удаление ресурса;  HEAD — получение в ответ на запрос только HTTP-заголовков. Не все методы поддерживаются браузерами — например, почти не применяется метод DELETE, поскольку сложно представить, что владельцы ресурса разрешат его удаление любому неавторизованному пользователю. Однако остальные методы весьма интен- сивно используются и часто имеют собственные особенности.

[[PHP 8. Наиболее полное руководство [2023].pdf#page=47&selection=6,0,35,57|PHP 8. Наиболее полное руководство [2023], page 47]]

> Клиент и сервер обмениваются друг с другом HTTP- сообщениями, которые состоят из трех частей (рис. 2.4):  начальная строка;  HTTP-заголовки;  тело сообщения (необязательная часть).

[[PHP 8. Наиболее полное руководство [2023].pdf#page=47&selection=39,0,52,38|PHP 8. Наиболее полное руководство [2023], page 47]]

> Начальная строка запроса содержит метод, ресурс на сервере, а также версию прото- кола HTTP и строится по следующей схеме: <метод> <ресурс> <версия протокола HTTP>

[[PHP 8. Наиболее полное руководство [2023].pdf#page=47&selection=69,0,72,40|PHP 8. Наиболее полное руководство [2023], page 47]]

> HTTP-заголовки строятся как пары ключ-значение, разделенные двоеточием: <название>: <значение> ВНИМАНИЕ! В конце HTTP-заголовка в качестве символа перевода строки всегда используется после- довательность \r\n — как в Windows. Использовать UNIX-перевод строки \n неправильно.

[[PHP 8. Наиболее полное руководство [2023].pdf#page=50&selection=10,0,19,84|PHP 8. Наиболее полное руководство [2023], page 50]]

> Однако несколько наиболее типичных HTTP-заголовков, которые браузер посы- лает серверу, мы все же рассмотрим:  Host: rambler.ru — каждый клиент обязательно отправляет HTTP-заголовок Host, в котором передается доменное имя сайта. Если сервер обслуживает несколько сай- тов, по этому заголовку он будет определять, к какому из сайтов адресован запрос;  Accept: text/html — сообщает, что клиент предпочитает получить заголовки в каком- либо определенном формате, в нашем случае — в виде HTML-страницы. Если у сервера есть несколько вариантов ответа на текущий запрос, он выдаст наиболее подходящий. Если вариант только один, сервер выдаст то, что есть.

[[PHP 8. Наиболее полное руководство [2023].pdf#page=50&selection=24,7,38,65|PHP 8. Наиболее полное руководство [2023], page 50]]

> Мы рассмотрели несколько заголовков, которые посылает браузер серверу. В ответ на запросы с такими заголовками сервер в HTTP-сообщении шлет заголовки:  Content-Type: text/html — сообщает о формате присланного документа, в нашем случае это HTML-страница;  Conetnt-Length: 256715 — сообщает о размере загружаемого документа, по нему браузер может оценить, на сколько процентов загружен документ;  Server: nginx — информационный заголовок, сообщающий название веб-сервера, обслуживающего запрос.

[[PHP 8. Наиболее полное руководство [2023].pdf#page=51&selection=4,0,20,22|PHP 8. Наиболее полное руководство [2023], page 51]]

> Переменные окружения представляют собой именованные значения параметров, кото- рые операционная система (точнее, процесс-родитель) передает запущенной програм- ме. Программа может с помощью специальных функций получить значение любой установленной переменной окружения, указав ее имя. Именно так и должна поступать серверная программа, когда захочет узнать значение того или иного заголовка запроса. К сожалению, набор передаваемых переменных окружения ограничен стандартами, и некоторые заголовки нельзя получить из сценария никаким способом. Такие случаи мы будем оговаривать особо. ПРИМЕЧАНИЕ Если быть до конца честными, то придется признать, что системный администратор все- таки может настроить сервер так, чтобы он посылал серверной программе и те заголовки, которые по стандарту не передаются.

[[PHP 8. Наиболее полное руководство [2023].pdf#page=51&selection=71,0,87,35|PHP 8. Наиболее полное руководство [2023], page 51]]

>  Формат: Content-Type: application/x-www-form-urlencoded  Переменная окружения: CONTENT_TYPE Этот заголовок идентифицирует тип передаваемых данных. Обычно в нем указывается значение application/x-www-form-urlencoded, определяющее формат, в котором все управляющие символы (отличные от алфавитно-цифровых и других отображаемых) специальным образом кодируются. Это тот самый формат передачи, который использу- ется методами GET и POST. Довольно распространен и другой формат: multipart/form- data. Мы рассмотрим его, когда будем обсуждать вопрос, касающийся загрузки файлов на сервер. Хотим обратить ваше внимание на то, что сервер никак не интерпретирует рассматри- ваемый заголовок, а просто передает его сценарию через переменную окружения.

[[PHP 8. Наиболее полное руководство [2023].pdf#page=52&selection=10,0,46,76|PHP 8. Наиболее полное руководство [2023], page 52]]

> Host  Формат: Host: имя_хоста  Переменная окружения: HTTP_HOST В соответствии с протоколом HTTP на каждом узле в Интернете могут располагаться сразу несколько хостов. Напоминаем, что узел имеет отдельный IP-адрес, и вполне типична ситуация, когда разные доменные имена соответствуют одному и тому же IP-адресу. Поэтому должен существовать какой-то способ, с помощью которого брау- зер сможет сообщить серверу, к какому хосту он собирается обращаться. Заголовок Host как раз и предназначен для этой цели. В нем браузер указывает то же самое имя хоста, которое ввел пользователь в адресной строке.

[[PHP 8. Наиболее полное руководство [2023].pdf#page=52&selection=48,0,73,51|PHP 8. Наиболее полное руководство [2023], page 52]]

> Формат: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:102.0) Gecko/20100101 Firefox/102.0  Переменная окружения: HTTP_USER_AGENT Через этот заголовок клиент сообщает серверу сведения о себе. Не всегда эти сведения точные и правдивые — многие роботы, занимающиеся сбором информации или разме- щением спам-сообщений, маскируются под обычных посетителей. Из приведенного здесь примера можно узнать версию браузера (в нашем случае это FireFox) и операционной системы (здесь 64-битная Windows 10.0).

[[PHP 8. Наиболее полное руководство [2023].pdf#page=52&selection=79,0,108,63|PHP 8. Наиболее полное руководство [2023], page 52]]

> Как правило, этот заголовок формируется браузером и содержит URL страницы, с ко- торой осуществился переход на текущую страницу по гиперссылке. Впрочем, если вы пишете программу, которая в целях безопасности отслеживает значение этого заголов- ка, следует помнить, что он может быть обрезан брандмауэром или умышленно подде- лан пользователем. ПРИМЕЧАНИЕ Вы, наверное, подумали, что слово по-английски должно было бы писаться с удвоенной буквой «r» — «referrer»? Да, вы правы. Однако те, кто придумывал стандарт HTTP, этого, видимо, не знали. Так что не позволяйте столь досадному факту ввести себя в заблужде- ние, когда будете в сценарии использовать переменную окружения HTTP_REFERER.

[[PHP 8. Наиболее полное руководство [2023].pdf#page=53&selection=4,0,19,1|PHP 8. Наиболее полное руководство [2023], page 53]]

>  Формат: Content-length: длина  Переменная окружения: CONTENT_LENGTH Заголовок содержит строку с количеством байтов в HTTP-теле, передаваемом методом POST. Эти сведения необходимы браузеру, чтобы правильно показывать процесс за- грузки страницы или файла.

[[PHP 8. Наиболее полное руководство [2023].pdf#page=53&selection=23,0,39,26|PHP 8. Наиболее полное руководство [2023], page 53]]

>  Формат: Accept: text/html, text/plain, image/gif, image/jpeg  Переменная окружения: HTTP_ACCEPT В этом заголовке браузер перечисляет, какие типы документов он «понимает». Пере- числение производится через запятую.

[[PHP 8. Наиболее полное руководство [2023].pdf#page=53&selection=64,0,77,36|PHP 8. Наиболее полное руководство [2023], page 53]]

> Каждый ответ сервера сопровождается HTTP-кодом ответа. Они всегда трехзначные и начинаются с одной из цифр: от 1 до 5 (табл. 2.1). В одном из предыдущих разделов мы познакомились только с одним из кодов: 200 — это код успешно обработанного запроса. Однако можно получить и другие коды — к примеру, 201, если в результате запроса что-то создается, например комментарий или статья. Код 201 как раз и сообщает об успешном создании запрошенного ресурса. Коды, начинающиеся с цифры 3, обозначают различного рода переадресации. Как пра- вило, вместе с таким HTTP-кодом приходит заголовок Location, в котором указывается адрес, по которому следует перейти браузеру, чтобы получить запрашиваемый ресурс.

[[PHP 8. Наиболее полное руководство [2023].pdf#page=53&selection=81,0,92,81|PHP 8. Наиболее полное руководство [2023], page 53]]

> Исследовать возможности протокола HTTP можно через браузер, но это не всегда удобно, особенно если вам необходимо отправить POST, DELETE или PUT-запрос. В браузере удобно работать с GET-запросами или полагаться на запросы, которые отправляет JavaScript-содержимое сайта. Поэтому системными администраторами и веб-разработчиками для работы с HTTP- запросами используется консольная утилита curl. Для того чтобы выполнить GET-запрос, достаточно выполнить команду curl и распо- ложить за ней адрес ресурса (URL), который необходимо загрузить. В примере, показанном на рис. 2.9, при выполнении GET-запроса к главной странице сервиса rambler.ru выдается ее HTML-содержимое. Если мы заходим исследовать HTTP-заголовки, которые присылает веб-сервер в ответ на наш запрос, можно добавить параметр -I (рис. 2.10). В этом случае на сервер вместо GET-запроса отправляется метод HEAD, и в ответ воз- вращаются только HTTP-заголовки без тела. Обратите внимание, что веб-сервер сайта работает уже в рамках HTTP версии 2. Если мы захотим передать на сервер собственный HTTP-заголовок, это можно сделать, воспользовавшись ключом -H

[[PHP 8. Наиболее полное руководство [2023].pdf#page=54&selection=65,0,102,2|PHP 8. Наиболее полное руководство [2023], page 54]]

